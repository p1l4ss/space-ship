!function(){"use strict";function t(t,e){if(0===e.r)return!1;const o=e.x-t.x,n=e.y-t.y;return o*o+n*n<=e.r*e.r}function e(t,e){const o=e.x-t.x,n=e.y-t.y;return{x:o,y:n,length:Math.sqrt(Math.pow(o,2)+Math.pow(n,2))}}function o(t,e){const{trueAnomaly:o}=t.orbit;return function(t,e){const{GM:o,semimajor:n,eccentricity:a,periapsisArgument:i}=t.orbit,s=n*(1-Math.pow(a,2))/(1+a*Math.cos(e)),r=Math.atan2(a*Math.sin(e),1+a*Math.cos(e)),h=Math.sqrt(o*(2/s-(1-n))),c=e+i;return{x:Math.cos(c)*s,y:-Math.sin(c)*s,flightAngle:r,v:h}}(t,o+e)}const n=149597870.7,a=[1e5,.117,.616,.924,.0661,.578,48.2,54.5,51.9,86.2,.0661].map((t=>t*Math.pow(10,6)/n)),i=[696340,2439.7,6051.8,6371,1737.4,3389.5,69911,58232,25362,24622,1188.3].map((t=>t/n)),s=["Sun","Mercury","Venus","Earth","Moon","Mars","Jupiter","Saturn","Uranus","Neptune","Pluto"],r=["hsl(60, 80%, 50%)","hsl(0, 0%, 60%)","hsl(0, 30%, 60%)","hsl(220, 80%, 60%)","hsl(0, 0%, 75%)","hsl(0, 80%, 60%)","hsl(30, 80%, 60%)","hsl(45, 80%, 60%)","hsl(190, 80%, 60%)","hsl(200, 80%, 60%)","hsl(30, 10%, 60%)"];const{MassProduct:h}=window.Astronomy;const c=[1,5,25,100,500,1e3,5e3,1e4,5e4];let l=1;const{BaryState:u,Body:d,MassProduct:y}=window.Astronomy,w=1.496*Math.pow(10,8),x=document.querySelector("#scene"),m=document.querySelector("#canvas"),M=document.querySelector("#speed"),p=document.querySelector("#ship"),v=document.querySelector("#fire"),f=document.querySelector("#throttle"),g=document.querySelector(".button.locate"),b=document.querySelector("#intro");document.querySelector("#keys").textContent="up = throttle, left/right = turn, 1–9 speed of simulation, +/- = zoom";let L=0,q=0;const P={x:0,y:0},S=m.getContext("2d"),E={},$=[];g.onclick=()=>{g.classList.add("disabled"),D&&(D=!1,H=A,b.textContent=""),L=0,P.x=0,P.y=0},f.onmousedown=f.ontouchstart=t=>{const e=f.querySelector(".bar"),o=f.querySelector(".amount"),n=f.clientHeight,a={y:(t.touches?t.touches[0]:t).pageY},i=X.throttle;function s(t){const s=(t.touches?t.touches[0]:t).pageY-a.y;X.throttle=i-s/n,X.throttle=Math.max(0,Math.min(1,X.throttle)),o.textContent=`${Math.round(100*X.throttle)} %`,e.style.height=100*X.throttle+"%"}function r(t){window.removeEventListener("mousemove",s),window.removeEventListener("mouseup",r),f.removeEventListener("touchmove",s),f.removeEventListener("touchend",r)}window.addEventListener("mousemove",s),window.addEventListener("mouseup",r),f.addEventListener("touchmove",s),f.addEventListener("touchend",r)},[["up",38],["left",37],["right",39],["plus","+"],["minus","-"]].forEach((([t,e])=>{const o=document.querySelector(`.${t}`),n=function(){E[e]=!1,o.onmouseup=o.onmouseleave=o.ontouchend=null,o.classList.remove("active")};o.onmousedown=o.ontouchstart=()=>{E[e]=!0,o.onmouseup=o.onmouseleave=o.ontouchend=n,o.classList.add("active")}})),["backward","forward"].forEach((t=>{const e=document.querySelector(`.${t}`),o=function(){e.onmouseup=e.onmouseleave=e.ontouchend=null,e.classList.remove("active")};e.onmousedown=e.ontouchstart=()=>{e.onmouseup=e.onmouseleave=e.ontouchend=o,"forward"===t?l+=1:"backward"===t&&(l-=1),l=Math.max(1,l),l=Math.min(9,l),e.classList.add("active")}})),window.addEventListener("keydown",(t=>{"+"===t.key||"-"===t.key?(E[t.key]=!0,"+"===t.key?document.querySelector(".button.plus").classList.add("active"):document.querySelector(".button.minus").classList.add("active")):(E[t.which]=!0,38===t.which?document.querySelector(".button.up").classList.add("active"):37===t.which?document.querySelector(".button.left").classList.add("active"):39===t.which&&document.querySelector(".button.right").classList.add("active"))})),window.addEventListener("keyup",(t=>{"+"===t.key||"-"===t.key?(E[t.key]=!1,"+"===t.key?document.querySelector(".button.plus").classList.remove("active"):document.querySelector(".button.minus").classList.remove("active")):(E[t.which]=!1,38===t.which?document.querySelector(".button.up").classList.remove("active"):37===t.which?document.querySelector(".button.left").classList.remove("active"):39===t.which&&document.querySelector(".button.right").classList.remove("active"))}));const k=5,I=5e10,A=5e10;let H=5,D=!0;const W=Date.now();let Y=0,T=W,C=Date.now(),F=0;const X=new class{constructor({x:t,y:e,r:o,ra:n,attached:a,throttle:i}){this.x=t,this.y=e,this.r=o,this.ra=n,this.vx=0,this.vy=0,this.attached=a,this.throttle=i}}({r:-90.2,x:0*i[3],y:1*i[3],ra:0,attached:3,throttle:1}),R={x:0,y:0};function B(n,a){const r=window.devicePixelRatio||1;T+=n;const u=1e3/n*86400,d=1e3/n;X.future=[];let w=X.x,x=X.y,m=X.vx,M=X.vy;const{x:p,y:v}=$[X.attached];X.gravity=function(t,o){const n=e(t,o),a=o.gm/Math.pow(n.length,2),i=a*n.x/n.length,s=a*n.y/n.length;return{x:i,y:s,direction:Math.atan2(i,s),length:a}}({x:p+X.x,y:v+X.y},{x:p,y:v,gm:y(s[X.attached])}),m+=X.gravity.x/u,M+=X.gravity.y/u,w+=m/u,x+=M/u;if(t({x:p+w,y:v+x},{x:p,y:v,r:i[X.attached]})){const t=-X.x,e=-X.y,o=Math.atan2(e,t),n=Math.cos(o)*i[X.attached],a=Math.sin(o)*i[X.attached];w=(t*n>0?-1:1)*n,x=(e*a>0?-1:1)*a,m=0,M=0}if(X.x=w,X.y=x,X.vx=m,X.vy=M,X.v=Math.sqrt(Math.pow(X.vx,2)+Math.pow(X.vy,2)),!D&&E[38]){Y||(Y=Date.now()),l>3&&(l=3);const t=4*X.throttle*.5,e=Math.cos(X.r*Math.PI/180)*t,o=-Math.sin(X.r*Math.PI/180)*t;X.vx+=e/u,X.vy+=o/u,X.acc=1}else X.acc=0;if(!a){if(E[49]?l=1:E[50]?l=2:E[51]?l=3:E[52]?l=4:E[53]?l=5:E[54]?l=6:E[55]?l=7:E[56]?l=8:E[57]&&(l=9),E[38]&&l>3&&(l=3),l>1){const t=c[l-1]/3;for(let e=0;e<t;e++)B(50,!0)}if(E[37]&&(X.r-=60/d),E[39]&&(X.r+=60/d),D||(0===L&&(E["+"]||E["-"])&&(P.x=0,P.y=0,L=-1,g.classList.remove("disabled")),E["+"]&&G(5,{x:.5,y:.5}),E["-"]&&G(-5,{x:.5,y:.5})),X.orbit=function(t,e,o){const n=Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2)),a=Math.sqrt(Math.pow(e.vx,2)+Math.pow(e.vy,2)),i=h(t),s=Math.atan2(e.x,e.y)-Math.atan2(e.vx,e.vy),r=Math.PI/2-s,c=2*i/(n*Math.pow(a,2)),l=Math.pow(c,2)-4*(1-c)*-Math.pow(Math.sin(s),2),u=n*((-c+Math.sqrt(l))/(2*(1-c))),d=n*((-c-Math.sqrt(l))/(2*(1-c))),y=Math.sqrt(Math.pow(n*Math.pow(a,2)/i-1,2)*Math.pow(Math.sin(s),2)+Math.pow(Math.cos(s),2)),w=1/(2/n-Math.pow(a,2)/i),x=Math.atan2(n*Math.pow(a,2)/i*Math.sin(s)*Math.cos(s),n*Math.pow(a,2)/i*Math.pow(Math.sin(s),2)-1),m=Math.sqrt(Math.pow(w,2)*(1-y)),M=Math.atan2(e.y,e.x)-x,p=Math.acos((y+Math.cos(x))/(1+y*Math.cos(x)));return{calculatedAt:o,eccentricity:y,rp:u,ra:d,trueAnomaly:x,flightAngle:r,semimajor:w,semiminor:m,periapsisArgument:M,GM:i,zenithAngle:s,meanMotion:Math.sqrt(i/Math.pow(w,3)),meanAnomaly:p-y*Math.sin(p)}}(s[X.attached],X,T),X.orbitPoints=function(e,n,a){const s=[],r=[],{x:h,y:c}=o(a,0),{x:l,y:u}=o(a,Math.PI/144e4),d=-(u-c);let y=1;((l-h)*a.vx<0||d*a.vy<0)&&(y=-1);for(let t=0;t<Math.PI/256;t+=Math.PI/72e4)s.push(t);for(let t=Math.PI/256;t<Math.PI;t+=Math.PI/9e3)s.push(t);for(let t=-Math.PI;t<-Math.PI/256;t+=Math.PI/9e3)s.push(t);for(let t=-Math.PI/256;t<=0;t+=Math.PI/72e4)s.push(t);for(let e=0;e<s.length;e++){const h=s[e],{x:c,y:l,v:u}=o(a,y*h);if(Number.isNaN(u))return a.orbit.hyperbolic=!0,r;a.orbit.hyperbolic=!1;const{x:d,y:w}=n[a.attached];r.push({x:c,y:l});const{x:x,y:m}=n[a.attached];if(t({x:d+c,y:w+l},{x:x,y:m,r:i[a.attached]}))return a.orbit.collide=!0,r;a.orbit.collide=!1}return r}(0,$,X),X.orbitPoints.length>2){const t=Math.min(...X.orbitPoints.map((({x:t,y:e})=>t))),e=Math.max(...X.orbitPoints.map((({x:t,y:e})=>t))),o=Math.min(...X.orbitPoints.map((({x:t,y:e})=>e))),n=Math.max(...X.orbitPoints.map((({x:t,y:e})=>e)));X.orbit.x=t+(e-t)/2,X.orbit.y=-(o+(n-o)/2),X.orbit.w=e-t,X.orbit.h=n-o}else X.orbit.x=null,X.orbit.y=null;if(D)if(g.classList.remove("disabled"),E[27]&&(D=!1,H=A,g.classList.add("disabled")),H<A){const t=Date.now()-W;t<2e3&&(b.textContent=""),b.textContent=t<3500?"Welcome to Flanets!":t<5500?"Fly around in your space ship with realistic gravity":t<8e3?"and planets where they actually are right now in our galaxy":t<1e4?"Open source at https://github.com/p1l4ss/space-ship":"Have fun!";G(H<80?1+H/80*1:H<250?2+2*H/200:4,{x:.5,y:.5})}else g.classList.add("disabled"),D=!1,b.textContent=""}if(0===L&&!X.orbit.hyperbolic&&X.orbitPoints.length>2){const t=Math.min(I,Math.min(.4*window.innerWidth*r/X.orbit.w,.4*window.innerHeight*r/X.orbit.h));H+=.01*(t-H)}}function N(){let t;if(s.forEach(((t,e)=>{if(0===e)return void($[e]={x:0,y:0});const{x:o,y:n}=function(t,e){return u(d[t],new Date(e))}(s[e],T);$[e]={x:o,y:n}})),s.forEach(((o,n)=>{const i=a[n],{length:s}=e({x:$[X.attached].x+X.x,y:$[X.attached].y+X.y},$[n]);s<i&&(t=n)})),null!=t&&t!==X.attached&&q<T-36e5){q=T;const e=$[X.attached].x+X.x,o=$[X.attached].y+X.y;X.attached=t,X.x=e-$[X.attached].x,X.y=o-$[X.attached].y}}function G(t,e){const o=window.devicePixelRatio||1,n=H;H+=t*H*.01,H<k?H=k:H>I&&(H=I);const a=(e.x*window.innerWidth-window.innerWidth/2)*o,i=(e.y*window.innerHeight-window.innerHeight/2)*o,s=a/H-a/n,r=i/H-i/n;P.x+=s,P.y+=r}function j(t){return t<0&&(t+=360),("00"+Math.round(t||0)%360).slice(-3)+"°"}X.future=[],N(),B(1e3/60),setInterval((t=>{const e=Date.now()-C;for(F+=e;F>t;)F-=t,B(t);C=Date.now()}),1e3/60,1e3/60),setInterval(N,1e3/60),window.addEventListener("touchstart",(t=>{t.preventDefault()})),window.addEventListener("touchmove",(t=>{t.preventDefault()})),x.onmousedown=x.ontouchstart=t=>{let e,o,n;t.preventDefault();const a=(t.touches?t.touches[0]:t).pageX,i=(t.touches?t.touches[0]:t).pageY,s={},r={x:P.x,y:P.y},h=t=>{if(t.preventDefault(),D)return;const h=window.devicePixelRatio||1;if(t.touches&&2===t.touches.length){const a={x:t.touches[0].pageX,y:t.touches[0].pageY},i={x:t.touches[1].pageX,y:t.touches[1].pageY},s={x:a.x+(i.x-a.x),y:a.y+(i.y-i.y)},h=Math.sqrt(Math.pow(i.x-a.x,2)+Math.pow(i.y-a.y,2));if(e&&2===e.length){const t={x:e[0].pageX,y:e[0].pageY},a={x:e[1].pageX,y:e[1].pageY},i=Math.sqrt(Math.pow(a.x-t.x,2)+Math.pow(a.y-t.y,2)),c=o;H*=h/i;const l={x:s.x-window.innerWidth/2,y:s.y-window.innerHeight/2},u={x:l.x/H-l.x/c,y:l.y/H-l.y/c};0===L&&(P.x=0,P.y=0,r.x=0,r.y=0,L=-1,g.classList.remove("disabled")),P.x=n.x+u.x,P.y=n.y+u.y}return e=t.touches,o=H,void(n={...P})}e=t.touches,o=H,n={...P},0===L&&(P.x=0,P.y=0,r.x=0,r.y=0,L=-1,g.classList.remove("disabled"));const c=(t.touches?t.touches[0]:t).pageX,l=(t.touches?t.touches[0]:t).pageY;s.x=(c-a)/H*h,s.y=(l-i)/H*h,P.x=r.x+s.x,P.y=r.y+s.y},c=()=>{window.removeEventListener("mousemove",h),window.removeEventListener("touchmove",h),window.removeEventListener("mouseup",c),window.removeEventListener("touchend",c)};window.addEventListener("mousemove",h),window.addEventListener("touchmove",h),window.addEventListener("mouseup",c),window.addEventListener("touchend",c)},window.addEventListener("wheel",(t=>{0===t.deltaY||D||(L>-1&&(P.x=0,P.y=0,L=-1,g.classList.remove("disabled")),G(-t.deltaY/16,{x:t.pageX/window.innerWidth,y:t.pageY/window.innerHeight}))}),{passive:!1}),function t(){window.requestAnimationFrame(t);const e=window.devicePixelRatio||1;S.scale(e,e);const o=window.innerWidth/2,n=window.innerHeight/2,a=window.innerWidth*e/2,h=window.innerHeight*e/2;0===L?(R.x=-($[X.attached].x+X.x),R.y=$[X.attached].y+X.y):(R.x=-($[X.attached].x+X.x)+P.x,R.y=$[X.attached].y+X.y+P.y);const u=Math.max(D?0:15,H/1e9),d=$[X.attached].x+X.x,y=$[X.attached].y+X.y,x=`translate(${o+(R.x+d)*H/e}px, ${n+(R.y-y)*H/e}px) rotate(${X.r}deg) scale(${u})`;p.style.transform=x,E[38]&&!E[16]&&X.throttle?v.style.opacity="":v.style.opacity=0,m.style.width=window.innerWidth+"px",m.style.height=window.innerHeight+"px",m.width=window.innerWidth*e,m.height=window.innerHeight*e;const f=X.orbitPoints.map((({x:t,y:e},o)=>({x:a+(R.x+$[X.attached].x+t)*H,y:h+(R.y-$[X.attached].y+e)*H})));S.fillStyle="hsl(270, 60%, 10%)",S.fillRect(0,0,window.innerWidth,window.innerHeight),S.beginPath(),f.forEach((({x:t,y:e},o)=>{S[o?"lineTo":"moveTo"](t,e)})),S.lineWidth=1.5*e,S.strokeStyle="hsl(0, 0%, 90%)",S.stroke(),s.forEach(((t,o)=>{const{x:n,y:c}=$[o],l=Math.max(3,i[o]*H);"Earth"===s[o]&&(S.beginPath(),S.arc(a+(R.x+n)*H,h+(R.y-c)*H,1.015*l,0,2*Math.PI),S.fillStyle=r[o].replace("hsl","hsla").replace(")",", 0.25)"),S.fill()),S.beginPath(),S.arc(a+(R.x+n)*H,h+(R.y-c)*H,l,0,2*Math.PI),S.fillStyle=r[o],S.fill(),S.font=(e>1?16:8)+"px -apple-system, BlinkMacSystemFont, avenir next, avenir, segoe ui, helvetica neue, helvetica, Ubuntu, roboto, noto, arial, sans-serif",S.textAlign="center",S.textBaseline="top";const u=a+(R.x+n)*H,d=h+(R.y-c)*H+l+(e>1?12:9);S.fillStyle="hsla(0, 0%, 0%, 0.9)",S.fillText(s[o],u-1,d-1),S.fillText(s[o],u+1,d-1),S.fillText(s[o],u-1,d+1),S.fillText(s[o],u+1,d+1),S.fillStyle="hsla(0, 0%, 100%, 0.9)",S.fillText(s[o],u,d)}));const g=Math.sqrt(Math.pow(X.vx,2)+Math.pow(X.vy,2)),b=Math.sqrt(Math.pow(X.x,2)+Math.pow(X.y,2))-i[X.attached],q=180*Math.atan2(X.vx,X.vy)/Math.PI;let k=Math.round(90+X.r-q);k<-180?k+=360:k>180&&(k-=360),M.innerHTML=`${new Date(T).toLocaleString()}${l>1?` (${function(t){return t>1?c[t-1]+"x":""}(l)})`:""}<br>${j(q)} (${(k>0?"+":"")+k}° → ${j(90+X.r)})<br>${function(t){const e=t*w/24;return Math.round(e)+" km/h"}(g)}${X.acc?` (+${(4*X.throttle).toFixed(2)} G)`:""}, ${function(t){const e=t*w;return e<2?Math.round(1e3*e)+" m":e<10?e.toFixed(2)+" km":e<100?e.toFixed(1)+" km":Math.round(e)+" km"}(b)}<br>${Y?function(t){const e=Math.floor(t/1e3)%60,o=Math.floor(t/1e3/60)%60,n=Math.floor(t/1e3/60/60)%24,a=Math.floor(t/1e3/60/60/24);return a?`T+${a}:${i(n)}:${i(o)}:${i(e)}`:`T+${i(n)}:${i(o)}:${i(e)}`;function i(t){return("0"+t).slice(-2)}}(T-Y):""}`}()}();
